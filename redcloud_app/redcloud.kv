<Logo@Image>:
    source: 'visuels/redcloud.png'
    size_hint: None, None
    size: 600, 435  # Définissez une taille explicite
    pos_hint : {'center_x': 0.5, 'center_y': 0.5}

<Background>:
    canvas.before:
        Color:
            rgba:  self.theme.background
        Rectangle:
            pos: self.pos
            size: self.size
    Logo:
    Widget:
        canvas.before:
            Color:
                rgba: 1,1,1,0.6
            RoundedRectangle:
                pos: self.pos
                size: self.size

<CWSimpleText>:
    color: app.theme.text_color
    font_size: '13sp'
    size_hint_y: None
    height: self.texture_size[1]
    align: 'left'
    text_size: self.width, None  # Permet à Kivy d'ajuster le texte à la taille du label

<CWLink>:
    background_normal: ''
    background_color: (1,1,1,0)
    color: app.theme.accent
    font_size: '13sp'
    text_size: self.width, None
    align: 'center'
    markup: True  # Active les balises
    bold: self.is_hovered and not self.is_pressed
    size_hint: None, 1
    cursor: "hand"
    pos_hint: {"center_x": 0.5, "center_y": 0.5}
    height: 30
    width: 150
    halign: "center"
    valign: "middle"

<Title1>:
    font_size: '20sp'
    color: app.theme.primary
    bold: True
    size_hint_y: None
    height: "40dp"

<Title2>:
    font_size: '18sp'
    color: app.theme.secondary
    bold: True
    size_hint_y: None
    height: "40dp"

<Title3>:
    font_size: '16sp'
    bold: True
    size_hint_y: None
    height: "40dp"

<CWLegend@Widget>:
    size_hint_y: None
    height: 1
    canvas:
        Color:
            rgba: app.theme.primary  # Couleur de la ligne
        Line:
            width: 2  # Largeur de la ligne
            points: [self.x, self.center_y, self.right, self.center_y]  # La ligne est tracée sur toute la largeur de l'écran à la hauteur du centre du widget

<CWLegend2@Widget>:
    size_hint_y: None
    height: 1.5
    canvas:
        Color:
            rgba: app.theme.secondary  # Couleur de la ligne
        Line:
            width: 1.5  # Largeur de la ligne
            points: [self.x, self.center_y, self.right, self.center_y]  # La ligne est tracée sur toute la largeur de l'écran à la hauteur du centre du widget

<CWLegend3@Widget>:
    size_hint_y: None
    height: 1
    canvas:
        Color:
            rgba: app.theme.text_color  # Couleur de la ligne
        Line:
            width: 1  # Largeur de la ligne
            points: [self.x, self.center_y, self.right, self.center_y]  # La ligne est tracée sur toute la largeur de l'écran à la hauteur du centre du widget

<CWTextInput>:
    hint_text: 'Entrez votre texte'
    font_size: '13sp'
    background_normal: ''  # Pas d'image de fond
    background_color:  1,1,1,0
    foreground_color: app.theme.primary
    size_hint_y: None
    height: 35
    text_align: 'left'  # Alignement du texte à gauche
    padding: [10, 10]  # Espace intérieur (pour que le texte ne touche pas les bords)
    cursor_color: (1, 0, 0, 1)  # Rouge
    cursor_blink: True  # Active le clignotement du curseur
    write_tab: False
    hint_text_color: 3,3,3,0.7

    canvas.before:
        Color:
            rgba: 1,1,1,0.8
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10]
        Color:
            rgba: app.theme.accent if self.is_hovered and not self.focus else app.theme.secondary if self.focus else app.theme.text_color
        Line:
            width: 1.2 if self.focus else 0.5  # Bordure fine par défaut
            rounded_rectangle: (self.x, self.y, self.width, self.height, 10)

# Boutons (validation, annulation, autres actions)
<ButtonTheme>:
    theme: app.theme
    cursor: "hand"
    background_normal: ''
    background_color: (1,1,1,0)
    font_size: '13sp'
    text_size: self.width, None
    pos_hint: {"center_x": 0.5,"center_y": 0.5}
    size_hint: None, None
    height: 30
    halign: 'center'
    bold: self.is_hovered and not self.is_pressed

    canvas.before:
        Color:
            rgba: self.theme.surface if self.is_pressed else (1,1,1,1) if self.is_hovered else  (1,1,1,0.5)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10]

<CWButton>:
    color: app.theme.text_color if self.is_pressed else app.theme.accent
    canvas.after:
        Color:
            rgba: self.theme.surface if self.is_pressed  else self.theme.text_color
        Line:
            width: 1.2 if self.is_hovered or self.is_pressed else 1
            rounded_rectangle: self.x, self.y, self.width, self.height, 10
        Line:
            width: 1
            rounded_rectangle: self.x + 3, self.y + 3, self.width - 6, self.height - 6, 10

<CWButtonOK>:
    text: 'OK'
    color: self.theme.success if  self.is_hovered or self.is_pressed else self.theme.text_color
    canvas.after:
        Color:
            rgba: app.theme.success if self.is_pressed or self.is_hovered else self.theme.text_color
        Line:
            width: 1.2 if self.is_hovered or self.is_pressed else 1
            rounded_rectangle: self.x, self.y, self.width, self.height, 15
        Line:
            width: 1
            rounded_rectangle: self.x + 3, self.y + 3, self.width - 6, self.height - 6, 15

<CWButtonCancel>:
    text: 'Cancel'
    color: app.theme.warning if  self.is_hovered or self.is_pressed else self.theme.text_color
    canvas.after:
        Color:
            rgba: app.theme.warning if self.is_pressed or self.is_hovered else self.theme.text_color
        Line:
            width: 1.2 if self.is_hovered or self.is_pressed else 1
            rounded_rectangle: self.x, self.y, self.width, self.height, 15
        Line:
            width: 1
            rounded_rectangle: self.x + 3, self.y + 3, self.width - 6, self.height - 6, 15

<CWSpinnerOption>:
    background_normal: ""  # Supprime l'image par défaut
    background_color: app.theme.background if self.is_hovered else (0,0,0,0.3)
    color: app.theme.primary if self.is_hovered else app.theme.text_color
    on_state:
        if self.state == 'down': self.color = (1, 0, 0.7, 1)  # Rouge au clic


<CWSpinner>:
    background_normal: ""  # Supprime l'image de fond par défaut
    background_color: (1, 1, 1, 0)  # Fond blanc
    canvas.after:
        Color:
            rgba: app.theme.primary if self.is_pressed else app.theme.text_color
        Line:
            width: 1.2 if self.is_hovered or self.is_pressed else 1
            rounded_rectangle: self.x, self.y, self.width, self.height, 10
        Line:
            width: 1
            rounded_rectangle: self.x + 3, self.y + 3, self.width - 6, self.height - 6, 10
    tab_focus: True
    option_cls: "CWSpinnerOption"  # Applique le style des options
    color: app.theme.text_color
    font_size: '13sp'
    size_hint: 1,None
    align: 'center'
    sync_height: True
    height: 40
<DateInput>:
<MessageBox>
    orientation: 'vertical'
    padding: 10
    spacing: 10
    CWSimpleText:
        id: message
        color: 1,1,1
    Widget
    CWButton:
        id: button_dismiss
        text: "OK"

<SigninScreen>:
    BoxLayout:
        padding: 10
        spacing: 10
        orientation: "vertical"
        size_hint: None, None
        size: 420,320
        pos_hint: {"center_x": 0.5,"center_y": 0.5}
        canvas.before:
            Color:
                rgba: 1,1,1,0.6
            RoundedRectangle:
                pos: self.pos
                size: self.size
        Title1:
            text: 'Paramètres Redmine'
        CWLegend:
        CWTextInput:
            id: redmine_user
            hint_text: 'login'
            text: 'klentin'
            focus: True
        CWTextInput:
            id: redmine_password
            hint_text: 'Mot de passe'
            password: True
            text: 'BN+xDS=C.BZeh8BHe8H$#eJap&G\\X^"Y'
        CWLegend2:
            size_hint_y: None
            height: 1
        CWTextInput:
            id: redmine_url
            hint_text: 'URL'
            text: 'https://redmine.esante-guyane.fr'
        CWTextInput:
            id: redmine_key
            hint_text: 'Clé API REST'
            text: '2de7244c1d584248e1765afb740d4e80c80dd702'
            password: True
        GridLayout:
            cols: 2
            rows: 1
            spacing: 20
            padding: 20
            halign: 'center'
            BoxLayout:
                orientation: 'vertical'
                SigninButton:
                    text: 'Yes'
                    pos_hint: {"center_x": 0.5,"center_x": 0.5}
            BoxLayout:
                orientation: 'vertical'
                CWButtonCancel:
                    text: 'Annuler'
                    pos_hint: {"center_x": 0.5,"center_x": 0.5}
<LoginScreen>:
    BoxLayout:
        padding: 10
        spacing: 10
        orientation: "vertical"
        size_hint: None, None
        size: 360,280
        pos_hint: {"center_x": 0.5,"center_y": 0.5}
        canvas.before:
            Color:
                rgba: 1,1,1,0.6
            RoundedRectangle:
                pos: self.pos
                size: self.size
        Title1:
            text: 'Connexions'
        CWLegend:
            size_hint_y: None
            height: 1
        CWTextInput:
            id: redmine_user
            hint_text: 'login'
            text: 'klentin'
            focus: True
        CWTextInput:
            id: redmine_password
            hint_text: 'Mot de passe'
            password: True
            text: 'BN+xDS=C.BZeh8BHe8H$#eJap&G\\X^"Y'
        Widget:
        GridLayout:
            cols: 2
            rows: 1
            spacing: 10
            padding: 10
            halign: 'center'
            BoxLayout:
                orientation: 'vertical'
                SigninButton:
                    text: 'Yes'
                    pos_hint: {"center_x": 0.5,"center_x": 0.5}
            BoxLayout:
                orientation: 'vertical'
                CWButtonCancel:
                    text: 'Annuler'
                    pos_hint: {"center_x": 0.5,"center_x": 0.5}
        CWLink:
            text: 'Réinitiliser mon compte'


<OTPSigninScreen>:

        BoxLayout:
            orientation: "vertical"
            size_hint_x: 0.4
            spacing: 10
            Widget:  # Espace pour centrer verticalement
            Title2:
                text: "Scannez le QR Code avec Authy ou FreeOTP"
            CWTextInput:
                id: otp_input
                hint_text: "Entrez le code OTP"
                font_size: 16
                height: 30
                halign: "center"

            BoxLayout:
                size_hint_y: None
                height: 50
                spacing: 10
                OTPButton:
                    text: "OK OTP"
                    on_press: root.validation()
                CWButtonCancel:
                    text: 'Annuler'
            Widget:  # Espace pour centrer verticalement

}
<DashScreen>:
    BoxLayout:
        orientation: "vertical"
        padding:20
        spacing: 20
        Title1:
            text: "Liste des demandes"
        CWLegend:
        ScrollView:
            GridLayout:
                id: table
                cols: 6
                size_hint_y: None
                height: self.minimum_height
                row_default_height: "40dp"
        # --- 🔽 Pied de page avec liste de projets & boutons ---
        BoxLayout:
            size_hint_y: None
            height: "50dp"
            spacing: "10dp"
            padding: "5dp"

            Spinner:
                id: project_spinner
                text: "Tous les projets"
                values: ["Tous les projets", "Projet A", "Projet B", "Projet C", "Projet D"]
                size_hint_x: 0.3
                on_text: root.filter_table(self.text)

            Widget:  # Espace flexible

            Button:
                text: "🔄"
                size_hint: None, None
                size: "32dp", "32dp"
                on_release: root.refresh_table()

            Button:
                text: "⚙️"
                size_hint: None, None
                size: "32dp", "32dp"
                on_release: root.open_settings()
<IssueDetailScreen>
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10
        canvas.before:
            Color:
                rgba: 1,1,1,0.6
            Rectangle:
                pos: self.pos
                size: self.size

        Title1:
            text: "Détails de la demande"
        CWLegend:
        GridLayout:
            size_hint_y: None
            height: 60
            cols: 4
            rows: 2
            Title2:
                text: root.project
            Title3:
                text: "Catégorie"
            Title3:
                text: "Priorité"
            Title3:
                text: "Statut"
            Title3:
                text: root.issue
            Title3:
                text: root.tracker_category
            Title3:
                text: root.priority
            Title3:
                text: root.state

        CWLegend3:
        Title3:
            text: "Description"
        CWLegend3:
        GridLayout:
            cols: 2
            spacing: 10
            BoxLayout:
                canvas.before:
                    Color:
                        rgba: 0.3, 0.3,0.3,0.1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                height: self.minimum_height
                padding: 20
                CWSimpleText:
                    text: root.description
                    pos_hint: {'center_x': 0.5,'y': 0.5}

                    padding: 20
            ScrollView:
                size_hint_x: 0.5
                orientation: 'vertical'
                BoxLayout:
                    canvas.before:
                        Color:
                            rgba: 0.3, 0.3,0.3,0.1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                    padding: 20
                    id: journals
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height

        CWLegend2:
        BoxLayout:
            orientation: 'horizontal'
            spacing: 10
            padding: 20
            size_hint_y: None
            height: 380
            GridLayout:
                spacing: 10
                rows: 2
                cols: 1
                size_hint: 0.65, 1
                BoxLayout:
                    orientation: 'vertical'
                    spacing: 10
                    size_hint: 1, None
                    height: 60
                    CWSimpleText:
                        text: 'Commentaire:'
                    CWTextInput:
                        id: redmine_commentaire
                BoxLayout:
                    orientation: 'vertical'
                    spacing: 10
                    size_hint: 1, None
                    height: 230
                    CWSimpleText:
                        text: 'Notes:'
                    CWTextInput:
                        id: redmine_note
                        text: "..."
                        multiline: True
                        height: '200dp'
            BoxLayout:
                orientation: 'vertical'
                size_hint: 0.35, 1
                padding: 10
                GridLayout:
                    spacing: 20
                    cols: 2
                    rows: 3
                    CWSpinner:
                        id: redmine_status
                        values: root.status
                        text: 'Status'
                    CWSpinner:
                        id: redmine_activity
                        text: 'Activity'
                        values: root.activities
                    BoxLayout:
                        orientation: 'vertical'
                        spacing: 10
                        size_hint: 1, None
                        height: 60
                        CWSimpleText:
                            text: "Date de Valeur"
                        DateInput:
                            id: redmine_date
                            hint_text: "DD/MM/YYYY"
                            halign: 'center'
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: 1, None
                        height: 60
                        spacing: 10
                        CWSimpleText:
                            text: "Temps passé"
                        CWTextInput:
                            id: redmine_time
                            hint_text: '0.0'
                            halign: 'center'
                BoxLayout:
                    size_hint: None, None
                    width: 350
                    height: 60
                    spacing: 10
                    padding:20
                    pos_hint: {"center_x": 0.5}
                    CWButtonOK:
                        width: 150
                        text: 'Enregistrer'

                    CWButton:
                        width: 150
                        text: "Retour"
                        on_press: root.set_screen('dashboard')
        CWLegend3:
        Widget:
